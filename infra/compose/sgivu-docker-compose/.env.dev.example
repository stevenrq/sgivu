# SGIVU — Plantilla para desarrollo. Copiar como .env.dev y reemplazar los placeholders.
# Detalle de cada variable: ENV-REFERENCE.md

########## PERFIL DE SPRING ##########
# Interruptor maestro: selecciona {servicio}-dev.yml en Config Server.
SPRING_PROFILES_ACTIVE=dev

########## FRONTEND ANGULAR ##########
# Controla CORS, redirects OAuth2 y postLogoutRedirectUri en auth y gateway.
DEV_ANGULAR_APP_URL=http://localhost:4200

########## SECRETO INTERNO ENTRE SERVICIOS ##########
# Header X-Internal-Service-Key para llamadas service-to-service sin JWT.
# DEBE ser idéntico en los 7 servicios backend + sgivu-ml.
SERVICE_INTERNAL_SECRET_KEY=your-internal-service-secret-key

########## EUREKA ##########
EUREKA_URL=http://sgivu-discovery:8761/eureka

########## URLs DE SERVICIOS ##########
# Llamadas directas service-to-service (el gateway usa lb:// vía Eureka, no estas URLs).
# En dev no se necesita ISSUER_URL: el default http://sgivu-auth:9000 coincide con el claim 'iss'.
SGIVU_AUTH_URL=http://sgivu-auth:9000
SGIVU_USER_URL=http://sgivu-user:8081
SGIVU_CLIENT_URL=http://sgivu-client:8082
SGIVU_VEHICLE_URL=http://sgivu-vehicle:8083
SGIVU_PURCHASE_SALE_URL=http://sgivu-purchase-sale:8084
# sgivu-auth registra la redirect URI OAuth2 del gateway con esta URL.
SGIVU_GATEWAY_URL=http://localhost:8080

########## JWT ##########
# Keystore RSA para firma de JWT. Si algún valor es incorrecto, sgivu-auth no arranca.
JWT_KEYSTORE_LOCATION=classpath:keystore.jks
JWT_KEYSTORE_PASSWORD=your-keystore-password
JWT_KEY_ALIAS=sgivu-jwt
JWT_KEY_PASSWORD=your-key-password

# Secreto OAuth2 auth↔gateway. Se almacena hasheado (BCrypt) en la BD al primer arranque.
# Cambiarlo después requiere eliminar el registro del cliente en sgivu_auth_db.
SGIVU_GATEWAY_SECRET=your-gateway-secret

########## REDIS — Solo gateway (sesiones BFF) ##########
# REDIS_PASSWORD debe coincidir entre el contenedor Redis (--requirepass) y el gateway.
REDIS_HOST=sgivu-redis
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password

########## AWS — S3 (imágenes de vehículos, sgivu-vehicle) ##########
AWS_ACCESS_KEY=your-aws-access-key-here
AWS_SECRET_KEY=your-aws-secret-key-here
AWS_REGION=us-east-1
AWS_VEHICLES_BUCKET=sgivu-vehicle-images
# Debe incluir los mismos dominios que DEV_ANGULAR_APP_URL (CORS del bucket S3).
AWS_S3_ALLOWED_ORIGINS=http://localhost:4200,https://localhost:4200

########## POSTGRESQL — Instancia compartida ##########
# Todos los servicios comparten este contenedor con BDs separadas.
POSTGRES_HOST=sgivu-postgres
POSTGRES_DB=postgres
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your-postgres-password

########## BASES DE DATOS POR SERVICIO ##########
# --- Auth ---
DEV_AUTH_DB_HOST=sgivu-postgres
DEV_AUTH_DB_PORT=5432
DEV_AUTH_DB_NAME=sgivu_auth_db
DEV_AUTH_DB_USERNAME=postgres
DEV_AUTH_DB_PASSWORD=your-postgres-password
# --- User ---
DEV_USER_DB_HOST=sgivu-postgres
DEV_USER_DB_PORT=5432
DEV_USER_DB_NAME=sgivu_user_db
DEV_USER_DB_USERNAME=postgres
DEV_USER_DB_PASSWORD=your-postgres-password
# --- Client ---
DEV_CLIENT_DB_HOST=sgivu-postgres
DEV_CLIENT_DB_PORT=5432
DEV_CLIENT_DB_NAME=sgivu_client_db
DEV_CLIENT_DB_USERNAME=postgres
DEV_CLIENT_DB_PASSWORD=your-postgres-password
# --- Vehicle ---
DEV_VEHICLE_DB_HOST=sgivu-postgres
DEV_VEHICLE_DB_PORT=5432
DEV_VEHICLE_DB_NAME=sgivu_vehicle_db
DEV_VEHICLE_DB_USERNAME=postgres
DEV_VEHICLE_DB_PASSWORD=your-postgres-password
# --- Purchase Sale ---
DEV_PURCHASE_SALE_DB_HOST=sgivu-postgres
DEV_PURCHASE_SALE_DB_PORT=5432
DEV_PURCHASE_SALE_DB_NAME=sgivu_purchase_sale_db
DEV_PURCHASE_SALE_DB_USERNAME=postgres
DEV_PURCHASE_SALE_DB_PASSWORD=your-postgres-password

########## FLYWAY ##########
# true en dev: permite baseline para BDs preexistentes sin historial de migraciones.
# NOTA: los YAMLs de dev hardcodean true, esta variable no tiene efecto real.
FLYWAY_BASELINE_ON_MIGRATE=true

########## MYSQL + ZIPKIN — Trazas distribuidas ##########
# MySQL se usa exclusivamente como storage de Zipkin.
MYSQL_HOST=sgivu-mysql
MYSQL_ROOT_PASSWORD=your-mysql-root-password
MYSQL_DATABASE=sgivu_zipkin_db
MYSQL_PASSWORD=your-mysql-password
MYSQL_USER=zipkin
# Zipkin usa nombres distintos para los mismos valores (MYSQL_DB vs MYSQL_DATABASE, etc).
STORAGE_TYPE=mysql
MYSQL_DB=sgivu_zipkin_db
MYSQL_PASS=your-mysql-password

########## sgivu-ml (FastAPI) ##########
# Pydantic Settings consume estas variables directamente (no pasan por Config Server).
ENVIRONMENT=dev
APP_NAME=sgivu-ml
APP_VERSION=0.1.0
# El 'issuer' descubierto debe coincidir con el claim 'iss' del JWT.
SGIVU_AUTH_DISCOVERY_URL=http://sgivu-auth:9000/.well-known/openid-configuration
MODEL_DIR=models
MODEL_NAME=demand_forecaster
REQUEST_TIMEOUT_SECONDS=15
DEFAULT_HORIZON_MONTHS=6
MIN_HISTORY_MONTHS=1
TARGET_COLUMN=sales_count
RETRAIN_CRON="0 3 1 * *"
RETRAIN_TIMEZONE=UTC
# Vacío = solo exige JWT válido sin verificar permisos específicos.
PERMISSIONS_PREDICT=ml:predict
PERMISSIONS_RETRAIN=ml:retrain
PERMISSIONS_MODELS=ml:models
DATABASE_ENV=dev
DEV_ML_DB_HOST=sgivu-postgres
DEV_ML_DB_PORT=5432
DEV_ML_DB_NAME=sgivu_ml_db
DEV_ML_DB_USERNAME=postgres
DEV_ML_DB_PASSWORD=your-postgres-password
DATABASE_AUTO_CREATE=false
DATABASE_ECHO=false
