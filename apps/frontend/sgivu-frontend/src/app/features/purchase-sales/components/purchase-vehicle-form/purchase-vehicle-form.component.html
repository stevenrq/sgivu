<fieldset class="border p-3 pt-2 rounded" [formGroup]="vehicleFormGroup()">
  <legend class="float-none w-auto px-2 h6 mb-0 text-muted">
    <i class="bi bi-truck-front-fill me-1"></i>Datos del vehículo a registrar
  </legend>
  <div class="row g-3 mt-0">
    <div class="col-md-3">
      <div class="form-floating">
        <select
          class="form-select"
          id="vehicleType"
          formControlName="vehicleType"
          (change)="onVehicleTypeChange()"
          [class.is-invalid]="
            vehicleFormGroup().controls.vehicleType.invalid &&
            (vehicleFormGroup().controls.vehicleType.touched ||
              vehicleFormGroup().controls.vehicleType.dirty)
          "
        >
          @for (kind of vehicleKinds; track kind) {
            <option [ngValue]="kind">
              {{ kind === "CAR" ? "Automóvil" : "Motocicleta" }}
            </option>
          }
        </select>
        <label for="vehicleType">Tipo de vehículo</label>
      </div>
      @if (
        vehicleFormGroup().controls.vehicleType.invalid &&
        (vehicleFormGroup().controls.vehicleType.touched ||
          vehicleFormGroup().controls.vehicleType.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Selecciona el tipo de vehículo.
        </div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleBrand"
          formControlName="brand"
          maxlength="20"
          [class.is-invalid]="
            vehicleFormGroup().controls.brand.invalid &&
            (vehicleFormGroup().controls.brand.touched ||
              vehicleFormGroup().controls.brand.dirty)
          "
          placeholder="Marca"
        />
        <label for="vehicleBrand">Marca</label>
      </div>
      @if (
        vehicleFormGroup().controls.brand.invalid &&
        (vehicleFormGroup().controls.brand.touched ||
          vehicleFormGroup().controls.brand.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa la marca.</div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleModel"
          formControlName="model"
          maxlength="20"
          [class.is-invalid]="
            vehicleFormGroup().controls.model.invalid &&
            (vehicleFormGroup().controls.model.touched ||
              vehicleFormGroup().controls.model.dirty)
          "
          placeholder="Modelo"
        />
        <label for="vehicleModel">Modelo</label>
      </div>
      @if (
        vehicleFormGroup().controls.model.invalid &&
        (vehicleFormGroup().controls.model.touched ||
          vehicleFormGroup().controls.model.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el modelo.</div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleLine"
          formControlName="line"
          maxlength="20"
          [class.is-invalid]="
            vehicleFormGroup().controls.line.invalid &&
            (vehicleFormGroup().controls.line.touched ||
              vehicleFormGroup().controls.line.dirty)
          "
          placeholder="Línea"
        />
        <label for="vehicleLine">Línea</label>
      </div>
      @if (
        vehicleFormGroup().controls.line.invalid &&
        (vehicleFormGroup().controls.line.touched ||
          vehicleFormGroup().controls.line.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa la línea.</div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehiclePlate"
          formControlName="plate"
          maxlength="10"
          [class.is-invalid]="
            vehicleFormGroup().controls.plate.invalid &&
            (vehicleFormGroup().controls.plate.touched ||
              vehicleFormGroup().controls.plate.dirty)
          "
          placeholder="Placa"
        />
        <label for="vehiclePlate">Placa</label>
      </div>
      @if (
        vehicleFormGroup().controls.plate.invalid &&
        (vehicleFormGroup().controls.plate.touched ||
          vehicleFormGroup().controls.plate.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Ingresa la placa del vehículo.
        </div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="number"
          min="1"
          class="form-control"
          id="vehicleCapacity"
          formControlName="capacity"
          [class.is-invalid]="
            vehicleFormGroup().controls.capacity.invalid &&
            (vehicleFormGroup().controls.capacity.touched ||
              vehicleFormGroup().controls.capacity.dirty)
          "
          placeholder="Capacidad de pasajeros"
        />
        <label for="vehicleCapacity">Capacidad de pasajeros</label>
      </div>
      @if (
        vehicleFormGroup().controls.capacity.invalid &&
        (vehicleFormGroup().controls.capacity.touched ||
          vehicleFormGroup().controls.capacity.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Ingresa la capacidad de pasajeros.
        </div>
      }
    </div>
    <div class="col-md-3">
      <div class="form-floating">
        <input
          type="number"
          min="1950"
          max="2050"
          class="form-control"
          id="vehicleYear"
          formControlName="year"
          [class.is-invalid]="
            vehicleFormGroup().controls.year.invalid &&
            (vehicleFormGroup().controls.year.touched ||
              vehicleFormGroup().controls.year.dirty)
          "
          placeholder="Año"
        />
        <label for="vehicleYear">Año</label>
      </div>
      @if (
        vehicleFormGroup().controls.year.invalid &&
        (vehicleFormGroup().controls.year.touched ||
          vehicleFormGroup().controls.year.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el año del vehículo.</div>
      }
    </div>
    <div class="col-md-3">
      <div class="price-field">
        <label for="vehicleMileage">Kilometraje</label>
        <div class="input-group price-group">
          <span class="input-group-text">km</span>
          <input
            type="text"
            inputmode="numeric"
            class="form-control"
            id="vehicleMileage"
            formControlName="mileage"
            pattern="^[0-9.,]+$"
            [value]="vehicleMileageInput"
            (input)="onMileageInput($any($event.target).value)"
            [class.is-invalid]="
              vehicleFormGroup().controls.mileage.invalid &&
              (vehicleFormGroup().controls.mileage.touched ||
                vehicleFormGroup().controls.mileage.dirty)
            "
            placeholder="Kilometraje"
          />
        </div>
      </div>
      @if (vehicleFormGroup().controls.mileage.value !== null) {
        <small class="text-muted"
          >{{
            formatMileage(vehicleFormGroup().controls.mileage.value)
          }}
          km</small
        >
      }
      @if (
        vehicleFormGroup().controls.mileage.invalid &&
        (vehicleFormGroup().controls.mileage.touched ||
          vehicleFormGroup().controls.mileage.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Ingresa el kilometraje en números.
        </div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleMotorNumber"
          formControlName="motorNumber"
          maxlength="30"
          [class.is-invalid]="
            vehicleFormGroup().controls.motorNumber.invalid &&
            (vehicleFormGroup().controls.motorNumber.touched ||
              vehicleFormGroup().controls.motorNumber.dirty)
          "
          placeholder="Número de motor"
        />
        <label for="vehicleMotorNumber">Número de motor</label>
      </div>
      @if (
        vehicleFormGroup().controls.motorNumber.invalid &&
        (vehicleFormGroup().controls.motorNumber.touched ||
          vehicleFormGroup().controls.motorNumber.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el número de motor.</div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleSerialNumber"
          formControlName="serialNumber"
          maxlength="30"
          [class.is-invalid]="
            vehicleFormGroup().controls.serialNumber.invalid &&
            (vehicleFormGroup().controls.serialNumber.touched ||
              vehicleFormGroup().controls.serialNumber.dirty)
          "
          placeholder="Número serial"
        />
        <label for="vehicleSerialNumber">Número serial</label>
      </div>
      @if (
        vehicleFormGroup().controls.serialNumber.invalid &&
        (vehicleFormGroup().controls.serialNumber.touched ||
          vehicleFormGroup().controls.serialNumber.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el número serial.</div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleChassisNumber"
          formControlName="chassisNumber"
          maxlength="30"
          [class.is-invalid]="
            vehicleFormGroup().controls.chassisNumber.invalid &&
            (vehicleFormGroup().controls.chassisNumber.touched ||
              vehicleFormGroup().controls.chassisNumber.dirty)
          "
          placeholder="Número de chasis"
        />
        <label for="vehicleChassisNumber">Número de chasis</label>
      </div>
      @if (
        vehicleFormGroup().controls.chassisNumber.invalid &&
        (vehicleFormGroup().controls.chassisNumber.touched ||
          vehicleFormGroup().controls.chassisNumber.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el número de chasis.</div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleColor"
          formControlName="color"
          maxlength="20"
          [class.is-invalid]="
            vehicleFormGroup().controls.color.invalid &&
            (vehicleFormGroup().controls.color.touched ||
              vehicleFormGroup().controls.color.dirty)
          "
          placeholder="Color"
        />
        <label for="vehicleColor">Color</label>
      </div>
      @if (
        vehicleFormGroup().controls.color.invalid &&
        (vehicleFormGroup().controls.color.touched ||
          vehicleFormGroup().controls.color.dirty)
      ) {
        <div class="invalid-feedback d-block">Ingresa el color.</div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleCity"
          formControlName="cityRegistered"
          maxlength="30"
          [class.is-invalid]="
            vehicleFormGroup().controls.cityRegistered.invalid &&
            (vehicleFormGroup().controls.cityRegistered.touched ||
              vehicleFormGroup().controls.cityRegistered.dirty)
          "
          placeholder="Ciudad de registro"
        />
        <label for="vehicleCity">Ciudad de registro</label>
      </div>
      @if (
        vehicleFormGroup().controls.cityRegistered.invalid &&
        (vehicleFormGroup().controls.cityRegistered.touched ||
          vehicleFormGroup().controls.cityRegistered.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Ingresa la ciudad de registro.
        </div>
      }
    </div>
    <div class="col-md-4">
      <div class="form-floating">
        <input
          type="text"
          class="form-control"
          id="vehicleTransmission"
          formControlName="transmission"
          maxlength="20"
          [class.is-invalid]="
            vehicleFormGroup().controls.transmission.invalid &&
            (vehicleFormGroup().controls.transmission.touched ||
              vehicleFormGroup().controls.transmission.dirty)
          "
          placeholder="Transmisión"
        />
        <label for="vehicleTransmission">Transmisión</label>
      </div>
      @if (
        vehicleFormGroup().controls.transmission.invalid &&
        (vehicleFormGroup().controls.transmission.touched ||
          vehicleFormGroup().controls.transmission.dirty)
      ) {
        <div class="invalid-feedback d-block">
          Ingresa el tipo de transmisión.
        </div>
      }
    </div>
    <div class="col-md-4">
      <div class="price-field">
        <label for="vehicleSalePrice">Precio de venta objetivo</label>
        <div class="input-group price-group">
          <span class="input-group-text">$</span>
          <input
            type="text"
            inputmode="numeric"
            class="form-control"
            id="vehicleSalePrice"
            formControlName="salePrice"
            pattern="^[0-9.,\\s$]*$"
            [value]="vehicleSalePriceInput"
            (input)="onPriceInput($any($event.target).value)"
            placeholder="Precio de venta objetivo"
          />
        </div>
      </div>
      @if (vehicleFormGroup().controls.salePrice.value !== null) {
        <small class="text-muted">{{
          formatCurrency(vehicleFormGroup().controls.salePrice.value)
        }}</small>
      }
    </div>
  </div>

  @if (isCarSelected) {
    <div class="row g-3 mt-1">
      <div class="col-md-4">
        <div class="form-floating">
          <input
            type="text"
            class="form-control"
            id="vehicleBodyType"
            formControlName="bodyType"
            maxlength="20"
            [class.is-invalid]="
              vehicleFormGroup().controls.bodyType.invalid &&
              (vehicleFormGroup().controls.bodyType.touched ||
                vehicleFormGroup().controls.bodyType.dirty)
            "
            placeholder="Tipo de carrocería"
          />
          <label for="vehicleBodyType">Tipo de carrocería</label>
        </div>
        @if (
          vehicleFormGroup().controls.bodyType.invalid &&
          (vehicleFormGroup().controls.bodyType.touched ||
            vehicleFormGroup().controls.bodyType.dirty)
        ) {
          <div class="invalid-feedback d-block">
            Ingresa el tipo de carrocería.
          </div>
        }
      </div>
      <div class="col-md-4">
        <div class="form-floating">
          <input
            type="text"
            class="form-control"
            id="vehicleFuelType"
            formControlName="fuelType"
            maxlength="20"
            [class.is-invalid]="
              vehicleFormGroup().controls.fuelType.invalid &&
              (vehicleFormGroup().controls.fuelType.touched ||
                vehicleFormGroup().controls.fuelType.dirty)
            "
            placeholder="Tipo de combustible"
          />
          <label for="vehicleFuelType">Tipo de combustible</label>
        </div>
        @if (
          vehicleFormGroup().controls.fuelType.invalid &&
          (vehicleFormGroup().controls.fuelType.touched ||
            vehicleFormGroup().controls.fuelType.dirty)
        ) {
          <div class="invalid-feedback d-block">
            Ingresa el tipo de combustible.
          </div>
        }
      </div>
      <div class="col-md-4">
        <div class="form-floating">
          <input
            type="number"
            min="2"
            max="6"
            class="form-control"
            id="vehicleDoors"
            formControlName="numberOfDoors"
            [class.is-invalid]="
              vehicleFormGroup().controls.numberOfDoors.invalid &&
              (vehicleFormGroup().controls.numberOfDoors.touched ||
                vehicleFormGroup().controls.numberOfDoors.dirty)
            "
            placeholder="Número de puertas"
          />
          <label for="vehicleDoors">Número de puertas</label>
        </div>
        @if (
          vehicleFormGroup().controls.numberOfDoors.invalid &&
          (vehicleFormGroup().controls.numberOfDoors.touched ||
            vehicleFormGroup().controls.numberOfDoors.dirty)
        ) {
          <div class="invalid-feedback d-block">
            Ingresa el número de puertas.
          </div>
        }
      </div>
    </div>
  }
  @if (isMotorcycleSelected) {
    <div class="row g-3 mt-1">
      <div class="col-md-4">
        <div class="form-floating">
          <input
            type="text"
            class="form-control"
            id="vehicleMotorcycleType"
            formControlName="motorcycleType"
            maxlength="20"
            [class.is-invalid]="
              vehicleFormGroup().controls.motorcycleType.invalid &&
              (vehicleFormGroup().controls.motorcycleType.touched ||
                vehicleFormGroup().controls.motorcycleType.dirty)
            "
            placeholder="Tipo de motocicleta"
          />
          <label for="vehicleMotorcycleType">Tipo de motocicleta</label>
        </div>
        @if (
          vehicleFormGroup().controls.motorcycleType.invalid &&
          (vehicleFormGroup().controls.motorcycleType.touched ||
            vehicleFormGroup().controls.motorcycleType.dirty)
        ) {
          <div class="invalid-feedback d-block">
            Indica el tipo de motocicleta.
          </div>
        }
      </div>
    </div>
  }
  <small class="text-muted d-block mt-3">
    El vehículo quedará disponible en el inventario una vez se cree el contrato
    de compra.
  </small>
</fieldset>
